# ==============================================================================
# Development Dockerfile
# ==============================================================================
# This Dockerfile is optimized for development with hot reload.
# It mounts your source code as a volume, so changes are reflected instantly.
# ==============================================================================

FROM node:20-alpine3.17

# Install pnpm globally
RUN npm install -g pnpm@latest

# Install required dependencies for Prisma on Alpine
RUN apk add --no-cache openssl1.1-compat

# Set working directory
WORKDIR /app

# Copy package files
COPY package.json pnpm-lock.yaml* ./

# Install ALL dependencies (including devDependencies for development)
RUN pnpm install --frozen-lockfile

# Copy prisma schema
COPY prisma ./prisma

# Generate Prisma client
RUN pnpm prisma:generate

# Create necessary directories
RUN mkdir -p uploads logs

# Expose port
EXPOSE 3000

# Start development server with hot reload
CMD ["pnpm", "dev"]
